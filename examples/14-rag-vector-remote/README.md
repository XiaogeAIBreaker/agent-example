# ğŸš€ RAG å‘é‡è¿œç¨‹æ•°æ®åº“ç¤ºä¾‹ 

> **Node.js + Supabase + TensorFlow å®ç°çš„æ™ºèƒ½è¯­ä¹‰æœç´¢ç³»ç»Ÿ**

## ğŸ“– é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ RAG (Retrieval-Augmented Generation) å‘é‡æ•°æ®åº“å®ç°ï¼Œå±•ç¤ºäº†å¦‚ä½•æ„å»ºç”Ÿäº§çº§çš„è¯­ä¹‰æœç´¢ç³»ç»Ÿï¼š

- ğŸ¯ **æ™ºèƒ½è¯­ä¹‰ç†è§£**: ä½¿ç”¨ TensorFlow Universal Sentence Encoder å°†æ–‡æœ¬è½¬æ¢ä¸º 384 ç»´å‘é‡
- ğŸ—„ï¸ **äº‘ç«¯å‘é‡å­˜å‚¨**: åŸºäº Supabase PostgreSQL + pgvector æ‰©å±•çš„å‘é‡æ•°æ®åº“
- ğŸ” **é«˜æ•ˆç›¸ä¼¼åº¦æœç´¢**: å®ç°æ¯«ç§’çº§çš„ä½™å¼¦ç›¸ä¼¼åº¦æ£€ç´¢
- ğŸŒ **å¯æ‰©å±•æ¶æ„**: æ”¯æŒå¤§è§„æ¨¡æ•°æ®å’Œé«˜å¹¶å‘æŸ¥è¯¢
- ğŸ’¼ **å®é™…åº”ç”¨åœºæ™¯**: ä»»åŠ¡ç®¡ç†ã€æ–‡æ¡£æ£€ç´¢ã€æ™ºèƒ½æ¨èç­‰

## ğŸ“ é¡¹ç›®ç»“æ„
```
rag-vector-remote/
â”œâ”€â”€ ğŸ“„ data/
â”‚   â””â”€â”€ tasks.json              # ç¤ºä¾‹ä»»åŠ¡æ•°æ®é›† (6ä¸ªä»»åŠ¡)
â”œâ”€â”€ ğŸ› ï¸ scripts/
â”‚   â”œâ”€â”€ uploadToSupabase.mjs    # å‘é‡åŒ–å¹¶ä¸Šä¼ æ•°æ®åˆ° Supabase
â”‚   â””â”€â”€ searchFromSupabase.mjs  # è¯­ä¹‰æœç´¢å’Œç›¸ä¼¼åº¦æ£€ç´¢
â”œâ”€â”€ ğŸ”§ .env                     # Supabase è¿æ¥é…ç½® (éœ€æ‰‹åŠ¨åˆ›å»º)
â”œâ”€â”€ ğŸ“– SETUP.md                 # æ•°æ®åº“é…ç½®è¯¦ç»†æŒ‡å—
â”œâ”€â”€ âš™ï¸ package.json             # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â””â”€â”€ ğŸ“š README.md                # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ§  **æ™ºèƒ½å‘é‡åŒ–**: TensorFlow Universal Sentence Encoder æä¾›é«˜è´¨é‡çš„è¯­ä¹‰ç†è§£
- âš¡ **æé€Ÿæ£€ç´¢**: pgvector çš„ IVFFLAT ç´¢å¼•æ”¯æŒæ¯«ç§’çº§æŸ¥è¯¢
- ğŸ”„ **è‡ªåŠ¨é€‚é…**: è‡ªåŠ¨å¤„ç†å‘é‡ç»´åº¦åŒ¹é… (384ç»´)
- ğŸ›ï¸ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰æœç´¢å‚æ•°å’Œç»“æœæ•°é‡
- ğŸš€ **ç”Ÿäº§å°±ç»ª**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å…‹éš†å¹¶å®‰è£…
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd examples/14-rag-vector-remote

# å®‰è£…ä¾èµ–
npm install
```

### æ­¥éª¤ 2: é…ç½® Supabase
1. åœ¨ [Supabase](https://supabase.com) åˆ›å»ºæ–°é¡¹ç›®
2. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š
```env
SUPABASE_URL=https://ä½ çš„é¡¹ç›®id.supabase.co
SUPABASE_KEY=ä½ çš„_anon_public_å¯†é’¥
```

### æ­¥éª¤ 3: åˆå§‹åŒ–æ•°æ®åº“
åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š
```sql
-- å¯ç”¨å‘é‡æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºè¡¨
CREATE TABLE todo_vectors (
  id uuid default gen_random_uuid() primary key,
  task text not null,
  embedding vector(384),
  priority text,
  due date,
  created_at timestamptz default now()
);

-- åˆ›å»ºæœç´¢å‡½æ•°
CREATE OR REPLACE FUNCTION match_todo_vector (
  query_embedding vector(384),
  match_count int default 5
) RETURNS TABLE (
  id uuid, task text, priority text, due date, similarity float
) LANGUAGE plpgsql AS $$
BEGIN
  RETURN QUERY
  SELECT t.id, t.task, t.priority, t.due,
         1 - (t.embedding <=> query_embedding) as similarity
  FROM todo_vectors t
  ORDER BY t.embedding <=> query_embedding
  LIMIT match_count;
END; $$;
```

### æ­¥éª¤ 4: ä¸Šä¼ å’Œæœç´¢
```bash
# å‘é‡åŒ–å¹¶ä¸Šä¼ æ•°æ®
npm run upload

# æ‰§è¡Œè¯­ä¹‰æœç´¢
npm run search
```

### ğŸ‰ å®Œæˆï¼
ä½ åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æœç´¢ç»“æœï¼š
```
ğŸ” æ£€ç´¢ç»“æœï¼š
1. ä»»åŠ¡åç§°ï¼šä»£ç é‡æ„ä¼˜åŒ–ã€‚æè¿°ï¼šä¼˜åŒ–æ ¸å¿ƒæ¨¡å—...
   ä¼˜å…ˆçº§ï¼šä¸­ | æˆªæ­¢æ—¥æœŸï¼š2025-06-15 | ç›¸ä¼¼åº¦ï¼š0.5792
```

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ä½œç”¨ |
|------|---------|------|
| ğŸ§  **AIæ¨¡å‹** | TensorFlow Universal Sentence Encoder | å°†æ–‡æœ¬è½¬æ¢ä¸º384ç»´è¯­ä¹‰å‘é‡ |
| ğŸ—„ï¸ **æ•°æ®åº“** | Supabase PostgreSQL + pgvector | äº‘ç«¯å‘é‡å­˜å‚¨å’Œç›¸ä¼¼åº¦æœç´¢ |
| âš¡ **è¿è¡Œæ—¶** | Node.js + JavaScript ESæ¨¡å— | é«˜æ€§èƒ½çš„å¼‚æ­¥å¤„ç† |
| ğŸ”Œ **å®¢æˆ·ç«¯** | @supabase/supabase-js | æ•°æ®åº“è¿æ¥å’ŒRPCè°ƒç”¨ |
| ğŸ¯ **ç´¢å¼•** | IVFFLAT (pgvector) | å¿«é€Ÿè¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ |

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡
- **å‘é‡ç»´åº¦**: 384ç»´ (384ä¸ªæµ®ç‚¹æ•°)
- **æœç´¢å»¶è¿Ÿ**: < 50ms (å–å†³äºæ•°æ®é‡)
- **ç›¸ä¼¼åº¦ç®—æ³•**: ä½™å¼¦è·ç¦» (Cosine Distance)
- **ç´¢å¼•ç±»å‹**: IVFFLAT (é€‚åˆä¸­ç­‰è§„æ¨¡æ•°æ®)

## ğŸ“‹ ç¤ºä¾‹æ•°æ®

é¡¹ç›®åŒ…å« 6 ä¸ªçœŸå®çš„ä»»åŠ¡åœºæ™¯ï¼Œå±•ç¤ºä¸åŒç±»å‹çš„å·¥ä½œå†…å®¹ï¼š

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | æˆªæ­¢æ—¥æœŸ | ç±»å‹ |
|------|--------|----------|------|
| ğŸ“ æ’°å†™é¡¹ç›®å‘¨æŠ¥ | é«˜ | 2025-06-10 | æ–‡æ¡£å·¥ä½œ |
| ğŸ“Š æ’°å†™æŠ¥è¡¨ | ä½ | 2025-06-10 | æ•°æ®åˆ†æ |
| ğŸ‘¥ è”ç³»å®¢æˆ·å®‰æ’æ¼”ç¤º | ä¸­ | 2025-06-08 | å®¢æˆ·å…³ç³» |
| ğŸ”§ ä»£ç é‡æ„ä¼˜åŒ– | ä¸­ | 2025-06-15 | æŠ€æœ¯å¼€å‘ |
| ğŸ’¬ ç”¨æˆ·åé¦ˆæ”¶é›† | ä½ | 2025-06-12 | äº§å“ç ”ç©¶ |
| ğŸ“– æŠ€æœ¯æ–‡æ¡£æ›´æ–° | ä¸­ | 2025-06-18 | æ–‡æ¡£å·¥ä½œ |

## ğŸ” æ™ºèƒ½æœç´¢ç¤ºä¾‹

### è¯­ä¹‰æœç´¢æ¼”ç¤º
```javascript
// æŸ¥è¯¢: "æˆ‘æœ€è¿‘æœ‰ä»€ä¹ˆé‡è¦ä»»åŠ¡è¦å®Œæˆï¼Ÿ"
// ç³»ç»Ÿä¼šè‡ªåŠ¨ç†è§£"é‡è¦"ã€"æœ€è¿‘"ç­‰è¯­ä¹‰ï¼Œè¿”å›ç›¸å…³ä»»åŠ¡

// æµ‹è¯•å…¶ä»–æŸ¥è¯¢åœºæ™¯:
"å‡†å¤‡å®¢æˆ·ä¼šè®®éœ€è¦åšä»€ä¹ˆï¼Ÿ"     // â†’ è”ç³»å®¢æˆ·å®‰æ’æ¼”ç¤º
"æœ‰ä»€ä¹ˆé«˜ä¼˜å…ˆçº§çš„å·¥ä½œï¼Ÿ"       // â†’ æ’°å†™é¡¹ç›®å‘¨æŠ¥  
"éœ€è¦å†™å“ªäº›æ–‡æ¡£ï¼Ÿ"           // â†’ æŠ€æœ¯æ–‡æ¡£æ›´æ–°ã€é¡¹ç›®å‘¨æŠ¥
"å…­æœˆä¸­æ—¬æœ‰ä»€ä¹ˆä»»åŠ¡ï¼Ÿ"        // â†’ ä»£ç é‡æ„ä¼˜åŒ–ã€æŠ€æœ¯æ–‡æ¡£æ›´æ–°
```

### è‡ªå®šä¹‰æŸ¥è¯¢
ä¿®æ”¹ `scripts/searchFromSupabase.mjs` ç¬¬18è¡Œï¼š
```javascript
const query = 'ä½ çš„è‡ªå®šä¹‰æŸ¥è¯¢'; // æ”¯æŒä¸­æ–‡è¯­ä¹‰æœç´¢
```

## âš™ï¸ é«˜çº§é…ç½®

### ğŸ›ï¸ æœç´¢å‚æ•°è°ƒä¼˜
```javascript
// åœ¨ searchFromSupabase.mjs ä¸­è°ƒæ•´
const { data, error } = await supabase.rpc('match_todo_vector', {
  query_embedding: queryEmbedding,
  match_count: 10,        // è¿”å›ç»“æœæ•°é‡ (1-100)
});
```

### ğŸ“š æ·»åŠ è‡ªå®šä¹‰æ•°æ®
1. **ç¼–è¾‘æ•°æ®æ–‡ä»¶**: ä¿®æ”¹ `data/tasks.json`
```json
{
  "name": "æ–°ä»»åŠ¡åç§°",
  "description": "è¯¦ç»†çš„ä»»åŠ¡æè¿°",
  "priority": "é«˜|ä¸­|ä½", 
  "due": "2025-MM-DD"
}
```

2. **é‡æ–°ä¸Šä¼ **: `npm run upload`

### ğŸ”§ æ•°æ®åº“ä¼˜åŒ–
```sql
-- è°ƒæ•´ç´¢å¼•å‚æ•° (åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­)
DROP INDEX IF EXISTS todo_vectors_embedding_idx;
CREATE INDEX todo_vectors_embedding_idx 
ON todo_vectors USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 200); -- å¢åŠ  lists æ•°é‡æå‡ç²¾åº¦
```

### ğŸ¯ å‘é‡ç»´åº¦è¯´æ˜
- **384ç»´**: å½“å‰é…ç½®ï¼Œå¹³è¡¡æ€§èƒ½å’Œç²¾åº¦
- **512ç»´**: æ›´é«˜ç²¾åº¦ï¼Œéœ€ä¿®æ”¹æ•°æ®åº“è¡¨å®šä¹‰
- **1536ç»´**: OpenAI æ ‡å‡†ï¼Œé€‚åˆå¤§è§„æ¨¡åº”ç”¨

## âš ï¸ é‡è¦è¯´æ˜

### ğŸ•’ é¦–æ¬¡è¿è¡Œ
- TensorFlow æ¨¡å‹ä¸‹è½½: ~100MBï¼Œéœ€è¦ 2-5 åˆ†é’Ÿ
- æ¨¡å‹ä¼šè‡ªåŠ¨ç¼“å­˜åˆ°æœ¬åœ°ï¼Œåç»­è¿è¡Œæ›´å¿«
- ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š

### ğŸ”‘ ç¯å¢ƒè¦æ±‚
- **Node.js**: 16+ (æ¨è 18+)
- **ç½‘ç»œ**: éœ€è¦è®¿é—® Supabase å’Œ TensorFlow Hub
- **Supabase**: å…è´¹ç‰ˆæ”¯æŒ 500MB æ•°æ®åº“

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

| é—®é¢˜ | é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| ğŸ”§ **å‡½æ•°æœªæ‰¾åˆ°** | `PGRST202` | åœ¨ Supabase ä¸­æ‰§è¡Œæ­¥éª¤3çš„SQLä»£ç  |
| ğŸ”‘ **è®¤è¯å¤±è´¥** | `supabaseKey is required` | æ£€æŸ¥ `.env` æ–‡ä»¶é…ç½® |
| ğŸ“ **ç»´åº¦ä¸åŒ¹é…** | `expected 384 dimensions` | å‘é‡ç»´åº¦å·²è‡ªåŠ¨å¤„ç†ä¸º384ç»´ |
| ğŸŒ **ç½‘ç»œè¶…æ—¶** | `model download failed` | æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œé‡è¯•è¿è¡Œ |
| ğŸ’¾ **æ•°æ®ä¸ºç©º** | `no results found` | å…ˆè¿è¡Œ `npm run upload` ä¸Šä¼ æ•°æ® |

### ğŸ› ï¸ è¯¦ç»†æ’é”™æ­¥éª¤

<details>
<summary>ç‚¹å‡»å±•å¼€è°ƒè¯•æŒ‡å—</summary>

#### 1. éªŒè¯ Supabase è¿æ¥
```bash
# åˆ›å»ºæµ‹è¯•è„šæœ¬
node -e "
const { createClient } = require('@supabase/supabase-js');
require('dotenv').config();
const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY);
console.log('Supabase connected:', !!supabase);
"
```

#### 2. æ£€æŸ¥æ•°æ®åº“å‡½æ•°
```sql
-- åœ¨ Supabase SQL ç¼–è¾‘å™¨ä¸­æŸ¥è¯¢
SELECT routine_name FROM information_schema.routines 
WHERE routine_name = 'match_todo_vector';
```

#### 3. æµ‹è¯•å‘é‡æœç´¢
```bash
# ä½¿ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=* npm run search
```

</details>

## ğŸš€ æ‰©å±•åº”ç”¨åœºæ™¯

### ğŸ’¼ ä¼ä¸šçº§åº”ç”¨
- **æ™ºèƒ½å®¢æœ**: åŸºäºçŸ¥è¯†åº“çš„è‡ªåŠ¨é—®ç­”
- **æ–‡æ¡£æ£€ç´¢**: ä¼ä¸šå†…éƒ¨æ–‡æ¡£æ™ºèƒ½æœç´¢  
- **äº§å“æ¨è**: åŸºäºç”¨æˆ·æè¿°çš„å•†å“åŒ¹é…
- **ä»£ç æœç´¢**: è¯­ä¹‰åŒ–çš„ä»£ç ç‰‡æ®µæ£€ç´¢

### ğŸ”§ æŠ€æœ¯æ‰©å±•æ–¹å‘
- ğŸŒ **Webç•Œé¢**: React/Vue + REST API
- ğŸ“± **ç§»åŠ¨ç«¯**: React Native / Flutter é›†æˆ
- ğŸ¤– **AIå¯¹è¯**: ç»“åˆ GPT/Claude æ„å»ºæ™ºèƒ½åŠ©æ‰‹
- ğŸ“Š **åˆ†æä»ªè¡¨æ¿**: æœç´¢è¡Œä¸ºåˆ†æå’Œä¼˜åŒ–
- ğŸ”„ **å®æ—¶åŒæ­¥**: WebSocket å®æ—¶æ•°æ®æ›´æ–°
- ğŸ¯ **å¤šæ¨¡æ€**: æ”¯æŒå›¾ç‰‡ã€éŸ³é¢‘å‘é‡åŒ–

### ğŸ“š å­¦ä¹ èµ„æº
- [Supabase Vector å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs/guides/database/extensions/pgvector)
- [TensorFlow.js æ¨¡å‹åº“](https://www.tensorflow.org/js/models)
- [å‘é‡æ•°æ®åº“æœ€ä½³å®è·µ](https://www.pinecone.io/learn/)

---

## ğŸ“ åé¦ˆä¸æ”¯æŒ

- ğŸ› **å‘ç°é—®é¢˜**: [æäº¤ Issue](https://github.com/your-repo/issues)
- ğŸ’¡ **åŠŸèƒ½å»ºè®®**: [è®¨è®ºåŒº](https://github.com/your-repo/discussions)  
- ğŸ“§ **æŠ€æœ¯æ”¯æŒ**: your-email@domain.com

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªæ˜Ÿæ ‡æ”¯æŒï¼**

## ğŸ“„ è®¸å¯è¯
MIT License - è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ 