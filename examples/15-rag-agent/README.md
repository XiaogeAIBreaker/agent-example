# 🚀 案例15: RAG Few-shot TodoList Agent

> **结合知识检索与示例学习的智能任务助手**

## ✨ 项目亮点

这是一个基于案例12与案例14迭代的高级智能体，具备以下突破性能力：

### 🧠 智能泛化能力
- **模糊表达理解**: 理解"记一下"、"mark一下"等口语化指令
- **意图自动解析**: 从"总是忘记事儿"推断出需要日常管理建议
- **情绪感知推荐**: 根据"心情不好"、"压力大"等状态推荐合适任务

### 📚 外部知识支持  
- **RAG知识检索**: 基于Supabase向量数据库的语义搜索
- **动态知识融合**: 实时检索相关知识增强回答质量
- **可扩展知识库**: 支持自定义知识条目和持续学习

### 💡 Few-shot学习
- **示例驱动**: 通过精心设计的对话示例提升理解能力
- **模式识别**: 自动识别用户表达模式并给出合适回应
- **上下文学习**: 在对话中不断优化回应策略

## 🎯 核心功能展示

### 1. 语义模糊表达理解
```
用户: "最近总是忘记事儿，帮我安排下日常吧"

Agent: 
🧠 思考过程：
用户没有明确提出任务项，仅表达了"忘事"的困扰和想被"安排日常"的诉求。
根据RAG检索到的知识："用户表达泛化需求时，可建议日常管理任务。"
结合示例匹配，我决定推荐基础的每日任务管理事项。

📋 执行计划：
我将添加3个典型的日常管理任务...

✅ 执行结果：
已成功添加以下任务到待办列表：查看每日待办、检查任务进度、晚间总结复盘
```

### 2. 口语表达类比理解
```
用户: "帮我mark一下：开空调、擦地、充iPad"

Agent:
🧠 思考过程：
用户使用了"mark一下"的非标准表达，根据向量库中对"记一下""打个钩"类表达的
处理经验，应转化为添加待办任务。并且语句中包含3个并列操作项。

📋 执行计划：
我将执行3次 addTodo 操作...

✅ 执行结果：
任务已添加：开空调、擦地、充iPad
```

### 3. 情绪状态智能推荐
```
用户: "最近状态不太好，给我点轻松的安排"

Agent:
🧠 思考过程：
用户表达了低落状态的情绪倾向。根据向量库中的心理学提示："当用户情绪低落时，
可推荐轻运动、创意活动或社交类任务"。结合few-shot示例中的情绪响应...

📋 执行计划：
添加以下任务以帮助改善情绪...

✅ 执行结果：
已为你添加以下轻松任务，建议自由选择执行：散步、看剧、联系朋友
```

## 🛠️ 技术实现特色

### ✅ 可插拔向量检索模块
- 基于Supabase pgvector的云端向量存储
- TensorFlow Universal Sentence Encoder文本嵌入
- 毫秒级语义相似度搜索

### ✅ 动态拼接Prompt系统
- Few-shot示例 + RAG检索知识 + 用户消息
- 智能上下文管理和Token优化
- 支持多轮对话中的知识累积

### ✅ 保留CoT思维过程
- 完整的推理链路透明化展示
- 思考过程 → 执行计划 → 结果总结
- 用户可见的AI决策逻辑

### ✅ Function Call执行闭环
- 支持所有TodoList操作工具
- 智能工具选择和参数填充
- 错误处理和结果反馈

## 🚀 快速开始

```bash
# 1. 安装依赖
npm install

# 2. 配置环境变量
cp env.example .env.local
# 编辑 .env.local 添加 DEEPSEEK_API_KEY 和 Supabase 配置

# 3. 初始化数据库
# 在 Supabase SQL 编辑器中执行 database-init.sql

# 4. 上传知识库
npm run upload-knowledge

# 5. 启动应用
npm run dev
```

详细设置指南请参考 [SETUP.md](./SETUP.md)

## 🌟 能力对比

| 能力项 | 案例12 CoT Agent | 案例15 RAG Few-shot Agent |
|--------|------------------|---------------------------|
| 任务执行 | ✅ 支持标准任务执行 | ✅ 同上 |
| 思考过程透明化 | ✅ 明确展示 | ✅ 同上 |
| 弱表达识别 | ❌ 需要明确命令 | ✅ 可理解模糊表达 |
| 任务推荐 | ❌ 仅处理明确请求 | ✅ 支持基于情绪/目标推荐 |
| 泛化能力 | ⛔️ 无泛化能力 | ✅ Few-shot + RAG 实现 |
| 知识支撑 | ❌ 无背景知识 | ✅ 支持RAG检索结果融合 |

## 📁 项目结构

```
15-rag-agent/
├── app/
│   ├── api/chat/
│   │   ├── route.ts           # 集成RAG的聊天API
│   │   └── todoManager.ts     # 任务管理器
│   ├── utils/
│   │   ├── vectorService.ts   # 向量化服务
│   │   └── ragService.ts      # RAG检索服务
│   └── ...
├── data/
│   └── knowledge-base.json    # RAG知识库数据
├── scripts/
│   ├── uploadKnowledge.mjs    # 知识库上传脚本
│   └── testSearch.mjs         # 搜索测试脚本
├── database-init.sql          # 数据库初始化脚本
├── SETUP.md                   # 详细设置指南
└── README.md                  # 项目说明
```

## 🎉 体验效果

成功部署后，你将拥有一个真正"聪明"的任务助手：

- 🎯 **理解你的真实意图**: 不再需要标准化命令
- 🧠 **感知你的情绪状态**: 根据心情推荐合适任务  
- 📚 **具备丰富知识**: 基于RAG提供专业建议
- 💭 **思维过程透明**: 让你了解AI如何思考
- 🔄 **持续学习改进**: 通过示例不断优化

这不仅仅是一个TodoList应用，更是一个展示现代AI能力的完整案例！
