# 🚀 RAG Few-shot TodoList Agent 设置指南

> **基于案例12与案例14的迭代版本，支持RAG知识检索 + Few-shot学习的智能任务助手**

## 📖 项目简介

案例15是一个结合了RAG（检索增强生成）和Few-shot学习的智能TodoList助手，具备以下核心能力：

- 🧠 **智能语义理解**: 理解模糊表达、口语化指令
- 📚 **知识检索增强**: 基于Supabase向量数据库的语义搜索
- 🎯 **情绪感知推荐**: 根据用户情绪状态推荐合适任务
- 💡 **Few-shot学习**: 通过示例学习提升对话质量
- 🔄 **CoT思维链**: 透明化的推理过程展示

## 🛠️ 快速开始

### 步骤 1: 环境准备

```bash
# 进入项目目录
cd examples/15-rag-agent

# 安装依赖
npm install
```

### 步骤 2: 配置环境变量

1. 复制环境变量模板：
```bash
cp env.example .env.local
```

2. 编辑 `.env.local` 文件：
```env
# DeepSeek API Key
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Supabase 配置
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_KEY=your_supabase_anon_key_here
```

### 步骤 3: 设置 Supabase 数据库

1. 在 [Supabase](https://supabase.com) 创建新项目
2. 在 SQL 编辑器中执行 `database-init.sql` 中的代码
3. 确保 pgvector 扩展已启用

### 步骤 4: 上传知识库

```bash
# 上传RAG知识库到Supabase
npm run upload-knowledge

# 测试向量搜索功能
npm run test-search
```

### 步骤 5: 启动应用

```bash
npm run dev
```

访问 http://localhost:3000 开始使用！

## 🎯 功能特性

### 1. 语义理解能力

**模糊表达识别**
- ✅ "记一下：开空调、擦地、充iPad" → 自动识别为添加3个任务
- ✅ "mark一下明天要做的事" → 理解为任务添加意图
- ✅ "别忘了提醒我" → 转换为待办事项

**日常安排理解**
- ✅ "最近总是忘记事儿，帮我安排下日常" → 推荐日常管理任务
- ✅ "帮我规划一下" → 提供结构化建议

### 2. 情绪感知推荐

**低落情绪处理**
- 输入："最近状态不太好，给我点轻松的安排"
- 输出：推荐散步、看剧、联系朋友等改善情绪的任务

**压力缓解建议**
- 输入："压力很大，需要放松"
- 输出：推荐深呼吸、泡茶、拉伸等减压活动

### 3. RAG知识检索

系统会自动检索相关知识来增强回答质量：
- 🔍 语义搜索匹配用户意图
- 📚 结合知识库内容生成回应
- 🎯 提供针对性的行动建议

### 4. CoT思维链展示

每次回复都包含完整的思考过程：
```
🧠 思考过程：
[详细的分析推理过程]

📋 执行计划：
[基于思考制定的行动方案]

✅ 执行结果：
[工具执行后的总结]
```

## 📊 技术架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户输入      │───▶│   向量化服务    │───▶│   RAG检索       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   CoT推理       │◀───│   知识增强      │◀───│   Supabase      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │
         ▼
┌─────────────────┐    ┌─────────────────┐
│   工具调用      │───▶│   任务管理      │
└─────────────────┘    └─────────────────┘
```

### 核心组件

| 组件 | 技术栈 | 作用 |
|------|--------|------|
| **向量化** | TensorFlow Universal Sentence Encoder | 文本转384维向量 |
| **向量数据库** | Supabase + pgvector | 语义搜索和存储 |
| **LLM推理** | DeepSeek Chat | CoT推理和工具调用 |
| **前端框架** | Next.js + React | 用户界面 |
| **状态管理** | 内存TodoManager | 任务数据管理 |

## 🔧 高级配置

### 调整RAG检索参数

在 `app/api/chat/route.ts` 中修改：
```typescript
const knowledgeResults = await ragService.searchKnowledge(
  queryEmbedding, 
  3,    // 返回结果数量
  0.3   // 相似度阈值
);
```

### 自定义知识库

编辑 `data/knowledge-base.json` 添加新的知识条目：
```json
{
  "category": "新类别",
  "title": "知识标题", 
  "content": "详细内容描述",
  "keywords": ["关键词1", "关键词2"],
  "action": "建议的行动类型"
}
```

然后重新上传：
```bash
npm run upload-knowledge
```

### 性能优化

**向量搜索优化**
```sql
-- 调整索引参数
DROP INDEX IF EXISTS knowledge_vectors_embedding_idx;
CREATE INDEX knowledge_vectors_embedding_idx 
ON knowledge_vectors USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 200); -- 增加lists提升精度
```

**模型预加载**
向量化模型会在服务器启动时自动预加载，首次请求响应更快。

## 🧪 测试用例

### 基础功能测试
```
用户: "今天要做：写日报、整理桌面、联系客户"
预期: 添加3个明确任务

用户: "记一下：洗衣服、去超市、打电话给老妈"  
预期: 识别口语表达，添加3个任务

用户: "最近总是忘记事儿，帮我安排下日常吧"
预期: 推荐日常管理任务
```

### 情绪感知测试
```
用户: "今天心情不好，帮我想三个要做的事"
预期: 推荐改善情绪的轻松活动

用户: "压力很大，需要放松一下"
预期: 推荐减压类任务
```

### RAG检索测试
```bash
# 运行测试脚本
npm run test-search

# 交互式测试
# 输入各种查询，观察RAG检索结果
```

## ⚠️ 注意事项

### 环境要求
- Node.js 18+
- 稳定的网络连接（TensorFlow模型下载）
- Supabase项目（免费版即可）

### 首次运行
- TensorFlow模型下载约100MB，需要2-5分钟
- 模型会缓存到本地，后续启动更快
- 确保有足够的磁盘空间

### 故障排除

**RAG检索失败**
- 检查Supabase配置是否正确
- 确认数据库表和函数已创建
- 验证知识库是否已上传

**向量化失败**
- 检查网络连接
- 清除模型缓存重新下载
- 确认TensorFlow依赖安装正确

**性能问题**
- 调整RAG检索的相似度阈值
- 减少返回结果数量
- 优化数据库索引配置

## 🎉 效果展示

成功配置后，你将获得一个具备以下能力的智能助手：

- 🎯 **理解模糊指令**: "记一下"、"mark一下" 等口语表达
- 🧠 **情绪感知推荐**: 根据心情推荐合适的任务
- 📚 **知识增强回答**: 基于RAG检索提供更准确的建议
- 💭 **透明思维过程**: 完整展示AI的推理逻辑
- 🔄 **持续学习**: 通过Few-shot示例不断改进

这是一个真正"聪明"的任务助手，不仅能执行命令，更能理解你的需求和情绪！ 