# 05 - 指令映射待办事项应用

## 项目简介

这是一个基于 Next.js 和 AI 的智能待办事项应用，实现了 **AI 指令到本地函数的映射** 功能。用户可以通过自然语言与 AI 对话，AI 会将用户的意图转换为结构化指令，然后通过映射系统执行相应的本地函数。

## 核心功能

### 🎯 指令映射系统
- **智能指令解析**: AI 理解自然语言并转换为结构化指令
- **函数映射表**: 将指令类型映射到具体的本地函数
- **闭环执行**: 从 AI 理解到函数执行的完整闭环

### 📝 待办事项操作
- **添加任务**: "帮我添加一个学习 Python 的任务"
- **完成任务**: "完成学习任务"  
- **删除任务**: "删除买菜任务"
- **列出任务**: "显示所有任务"
- **清除操作**: "清除已完成的任务" / "清除所有任务"

### 🤖 AI 对话
- 自然语言交互
- 智能意图识别
- 实时指令执行反馈

## 技术架构

### 指令映射流程

```
用户输入 → AI 理解 → 结构化指令 → 映射器 → 本地函数 → 执行结果
```

### 核心组件

1. **InstructionMapper**: 指令映射器类
   - 注册函数到映射表
   - 执行指令映射
   - 支持动态函数注册

2. **useInstructionMapping**: 映射管理 Hook
   - 管理所有待办事项操作函数
   - 自动注册函数到映射器
   - 提供统一的指令执行接口

3. **useInstructionExecutor**: 指令执行器 Hook
   - 解析 AI 返回的 JSON 指令
   - 执行相应的映射函数
   - 处理执行结果

### 指令格式

AI 输出的标准指令格式：
```json
{
  "action": "add|complete|delete|list|clear_completed|clear_all",
  "task": "任务内容或关键词",
  "response": "给用户的回复"
}
```

## 项目结构

```
05-instruction-mapping/
├── app/
│   ├── components/
│   │   └── ChatSidebar.tsx          # AI 对话组件
│   ├── hooks/
│   │   ├── useInstructionMapping.ts # 指令映射管理
│   │   └── useInstructionExecutor.ts# 指令执行器
│   ├── utils/
│   │   ├── instructionMapper.ts     # 核心映射器
│   │   └── jsonParser.ts           # JSON 解析工具
│   ├── api/
│   │   └── chat/route.ts           # AI 聊天 API
│   └── page.tsx                    # 主页面
├── package.json
└── README.md
```

## 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 配置环境变量
创建 `.env.local` 文件：
```env
DEEPSEEK_API_KEY=your_deepseek_api_key
```

### 3. 启动应用
```bash
npm run dev
```

应用将在 http://localhost:3000 启动。

## 使用示例

### 基础操作
- "帮我添加一个买菜任务"
- "添加学习 React 的任务"
- "完成买菜任务"
- "删除学习任务"

### 批量操作
- "显示所有任务"
- "清除已完成的任务"
- "清除所有任务"

### 复杂交互
- "我想添加三个任务：买菜、学习、运动"
- "帮我完成所有包含学习的任务"

## 核心特性

### 🔄 指令映射机制

1. **函数注册**: 通过 `registerFunction()` 注册操作函数
2. **指令解析**: AI 输出被解析为标准指令格式
3. **映射执行**: 根据 action 类型调用对应的注册函数
4. **结果反馈**: 执行结果实时反馈给用户

### 🛠️ 扩展性设计

- **模块化架构**: 映射器、执行器、解析器独立
- **类型安全**: 完整的 TypeScript 类型定义
- **可配置**: 支持动态注册新的操作函数
- **可测试**: 各模块独立，便于单元测试

### 🎨 用户体验

- **自然交互**: 支持自然语言输入
- **即时反馈**: 实时显示执行结果
- **错误处理**: 完善的错误提示和处理
- **可视化**: 清晰的 UI 状态展示

## 技术栈

- **前端框架**: Next.js 14
- **类型系统**: TypeScript
- **AI SDK**: Vercel AI SDK
- **AI 模型**: DeepSeek
- **样式**: Tailwind CSS
- **状态管理**: React Hooks

## 开发说明

### 添加新的操作类型

1. 在 `instructionMapper.ts` 中扩展 `Instruction` 接口
2. 在 `jsonParser.ts` 中更新 `TodoAction` 类型
3. 在 `useInstructionMapping.ts` 中实现对应的函数
4. 注册新函数到映射器

### 自定义指令解析

可以在 `jsonParser.ts` 中修改 `safeParseJSON` 函数来支持更复杂的指令格式。

## 项目亮点

1. **创新的映射机制**: 首次实现 AI 指令到本地函数的自动映射
2. **完整的闭环系统**: 从理解到执行的完整链路
3. **高度可扩展**: 支持动态添加新的操作类型
4. **类型安全**: 全程 TypeScript 类型保护
5. **用户友好**: 自然语言交互，降低使用门槛

## 后续扩展

- [ ] 支持更复杂的指令组合
- [ ] 添加指令执行历史记录
- [ ] 实现指令撤销功能
- [ ] 支持自定义指令模板
- [ ] 集成数据库持久化
- [ ] 添加指令执行权限控制

---

这个项目展示了如何将 AI 的理解能力与应用的执行能力完美结合，为构建更智能的人机交互应用提供了新的思路。
