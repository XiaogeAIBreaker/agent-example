# 06 - 上下文记忆待办事项应用

## 项目简介

这是基于案例05的迭代版本，在 **AI 指令映射** 的基础上新增了 **上下文记忆** 功能。应用现在具备了对话历史记录、上下文引用解析以及智能的任务关联能力，能够理解诸如"再加一个任务"、"完成刚才那个"等上下文相关的指令。

## 🆕 新增功能

### 🧠 上下文记忆系统
- **对话历史**: 自动记录用户消息和AI回复
- **操作记录**: 追踪所有执行的任务操作
- **上下文关联**: 维护最近的任务和操作状态

### 🔗 智能上下文引用
- **"刚才那个"**: 自动引用最近添加的任务
- **"再加一个"**: 基于上次添加的任务类型智能推荐
- **"最后添加的"**: 精确定位最近的操作目标
- **"完成刚才的"**: 智能关联到对应的任务

### 💭 记忆可视化
- **记忆视图**: 可切换查看完整的对话记忆
- **类型标识**: 区分用户消息、AI回复、操作执行等
- **时间戳**: 精确的操作时间记录
- **记忆管理**: 支持清除历史记录

## 核心功能

### 🎯 指令映射系统（继承自案例05）
- 智能指令解析和函数映射
- 结构化指令执行
- 实时操作反馈

### 📝 待办事项操作（增强版）
- **智能添加**: "帮我添加学习任务" → "再加一个类似的"
- **上下文完成**: "完成刚才添加的任务"
- **关联删除**: "删除最后那个任务"
- **批量操作**: 支持基于上下文的批量处理

### 🤖 增强AI对话
- 上下文感知的自然语言理解
- 智能的指令生成和执行
- 基于记忆的个性化回复

## 技术架构

### 记忆管理流程

```
用户输入 → 上下文解析 → 记忆记录 → AI理解 → 指令映射 → 函数执行 → 结果记录
```

### 核心组件

1. **useMemory Hook**: 记忆管理核心
   - 对话历史记录
   - 上下文引用解析
   - 记忆持久化管理

2. **MemoryEntry Interface**: 记忆条目结构
   - 类型化的记忆存储
   - 元数据关联
   - 时间戳管理

3. **Context Resolver**: 上下文解析器
   - 智能引用识别
   - 任务关联分析
   - 模式匹配处理

4. **Enhanced ChatSidebar**: 增强对话组件
   - 双视图显示（对话/记忆）
   - 上下文信息展示
   - 快捷输入建议

### 记忆数据结构

```typescript
interface MemoryEntry {
  id: string;
  timestamp: number;
  type: 'user_message' | 'ai_response' | 'action_executed' | 'context_reference';
  content: string;
  metadata?: {
    action?: string;
    taskId?: number;
    taskText?: string;
    reference?: string;
  };
}
```

## 项目结构

```
06-context-memory/
├── app/
│   ├── components/
│   │   └── ChatSidebar.tsx          # 增强对话组件
│   ├── hooks/
│   │   ├── useMemory.ts             # 🆕 记忆管理Hook
│   │   ├── useInstructionMapping.ts # 增强版映射Hook
│   │   └── useInstructionExecutor.ts# 指令执行器
│   ├── utils/
│   │   ├── instructionMapper.ts     # 核心映射器
│   │   └── jsonParser.ts           # JSON解析工具
│   ├── api/
│   │   └── chat/route.ts           # 增强AI聊天API
│   └── page.tsx                    # 主页面
├── package.json
└── README.md
```

## 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 配置环境变量
创建 `.env.local` 文件：
```env
DEEPSEEK_API_KEY=your_deepseek_api_key
```

### 3. 启动应用
```bash
npm run dev
```

应用将在 http://localhost:3000 启动。

## 使用示例

### 🆕 上下文引用操作

#### 基本流程
1. "帮我添加一个学习Python的任务"
2. "再加一个类似的任务" ➜ 智能添加学习相关任务
3. "完成刚才那个任务" ➜ 完成最后添加的任务
4. "删除最后添加的" ➜ 删除指定任务

#### 高级用法
- "再加三个学习任务"
- "把刚才所有的都完成"
- "清除最近添加的那些"

### 🔄 智能模式识别

```
用户: "添加买菜任务"
AI: 添加了"买菜"任务

用户: "再加一个"
AI: 基于上次模式，添加了"买水果"任务

用户: "完成第一个"  
AI: 完成了"买菜"任务
```

## 核心特性

### 🧠 记忆能力

1. **短期记忆**: 保持最近10轮对话
2. **操作记忆**: 记录最近10个操作
3. **任务记忆**: 追踪最后添加的任务
4. **模式记忆**: 学习用户的操作模式

### 🔗 上下文理解

- **时间引用**: "刚才"、"最近"、"上个"
- **位置引用**: "最后一个"、"第一个"
- **类型引用**: "类似的"、"相同的"
- **模糊引用**: 基于上下文智能推断

### 🎨 用户体验

- **记忆可视化**: 清晰的记忆历史展示
- **智能建议**: 基于上下文的快捷输入
- **双视图**: 对话和记忆的无缝切换
- **实时反馈**: 即时的操作确认

## 与案例05的区别

| 功能 | 案例05 | 案例06 |
|------|--------|--------|
| 指令映射 | ✅ | ✅ |
| 上下文记忆 | ❌ | 🆕 ✅ |
| 对话历史 | ❌ | 🆕 ✅ |
| 智能引用 | ❌ | 🆕 ✅ |
| 记忆可视化 | ❌ | 🆕 ✅ |
| 模式学习 | ❌ | 🆕 ✅ |

## 技术亮点

1. **创新的记忆架构**: 多层次的上下文记忆系统
2. **智能引用解析**: 自然语言到具体操作的映射
3. **状态持久化**: 会话级别的记忆保持
4. **类型安全**: 完整的TypeScript记忆类型系统
5. **性能优化**: 高效的记忆存储和检索机制

## 后续扩展

- [ ] 跨会话记忆持久化
- [ ] 更复杂的上下文模式识别
- [ ] 记忆压缩和归档机制
- [ ] 多用户记忆隔离
- [ ] 记忆搜索和查询功能
- [ ] 智能记忆推荐系统

---

这个项目展示了如何为AI应用添加记忆能力，让人机交互更加自然和智能。通过上下文记忆，AI不再是无状态的工具，而是真正理解对话历史的智能助手。
