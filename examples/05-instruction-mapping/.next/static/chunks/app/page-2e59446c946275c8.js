(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{668:(e,t,s)=>{Promise.resolve().then(s.bind(s,7292))},7292:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(5155),r=s(2115),c=s(5879);function l(e){let{executeInstruction:t,onInstructionExecuted:s}=e,[l,n]=(0,r.useState)([]),{parseAndExecuteMessage:o}=function(e){let{executeInstruction:t}=e;return{parseAndExecuteMessage:(0,r.useCallback)(e=>{if(!/\{[^}]*"action"[^}]*\}/.test(e))return null;let s=function(e){try{let s=e.match(/\{[^}]*\}/);if(!s)return null;let a=s[0],r=JSON.parse(a);if("object"==typeof r&&null!==r&&"action"in r&&["add","complete","delete","list","clear_completed","clear_all"].includes(r.action)){var t;if(("add"===r.action||"complete"===r.action||"delete"===r.action)&&(!r.task||"string"!=typeof r.task||""===r.task.trim()))return null;return{action:r.action,task:null==(t=r.task)?void 0:t.trim()}}return null}catch(e){return console.warn("JSON解析失败:",e),null}}(e);if(!s)return console.warn("无法解析AI返回的指令"),{success:!1,message:"指令格式错误，无法解析"};let a={action:s.action,task:s.task};return console.log("执行AI指令:",a),t(a)},[t]),processAIResponse:(0,r.useCallback)(e=>{let s=[],a=e.match(/\{[^}]*"action"[^}]*\}/g);return a&&a.forEach((e,a)=>{try{let r=JSON.parse(e);if(r.action&&["add","complete","delete","list","clear_completed","clear_all"].includes(r.action)){let e={action:r.action,task:r.task},c=t(e);s.push(c),console.log("执行第".concat(a+1,"个指令:"),e,"结果:",c)}}catch(t){console.warn("解析指令失败:",e,t),s.push({success:!1,message:"指令".concat(a+1,"解析失败")})}}),s},[t])}}({executeInstruction:t||(()=>({success:!1,message:"指令执行器未配置"}))}),{messages:d,input:i,handleInputChange:u,handleSubmit:g,status:x}=(0,c.Y_)({api:"/api/chat",onFinish:e=>{if(t){let t=o(e.content);if(t){let e=t.success?"✅ ".concat(t.message):"❌ ".concat(t.message);n(t=>[...t,e]),s&&s({success:t.success,message:t.message})}}}}),m=(0,r.useRef)(null),h="submitted"===x||"streaming"===x,p=()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})};return(0,r.useEffect)(()=>{p()},[d,l]),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"\uD83E\uDD16 AI 指令助手"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"我可以通过指令映射直接操作你的待办事项"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"支持：添加、完成、删除、列表、清除等操作"})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===d.length&&(0,a.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8",children:[(0,a.jsx)("p",{className:"text-2xl mb-2",children:"\uD83C\uDFAF"}),(0,a.jsx)("p",{children:"你好！我是你的 AI 指令助手"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"我可以直接执行待办事项操作"}),(0,a.jsxs)("div",{className:"mt-3 text-xs text-gray-400 dark:text-gray-500 space-y-1",children:[(0,a.jsx)("p",{children:"\uD83D\uDCDD “添加学习 Python 任务”"}),(0,a.jsx)("p",{children:"✅ “完成学习任务”"}),(0,a.jsx)("p",{children:"\uD83D\uDDD1️ “删除买菜任务”"}),(0,a.jsx)("p",{children:"\uD83D\uDCCB “显示所有任务”"})]})]}),d.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsx)("div",{className:"max-w-[85%] px-3 py-2 rounded-lg text-sm ".concat("user"===e.role?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white"),children:(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.content})})},e.id)),l.map((e,t)=>(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 text-green-800 dark:text-green-300 px-3 py-2 rounded-lg text-sm max-w-[90%]",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-green-600",children:"⚡"}),(0,a.jsxs)("span",{children:["指令执行结果：",e]})]})})},"result-".concat(t))),h&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white px-3 py-2 rounded-lg text-sm",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"}),(0,a.jsx)("span",{children:"正在分析指令并执行中..."})]})})}),(0,a.jsx)("div",{ref:m})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 p-3",children:(0,a.jsxs)("form",{onSubmit:g,className:"flex gap-2",children:[(0,a.jsx)("input",{value:i,onChange:u,placeholder:"输入指令，如：添加学习任务...",disabled:h,className:"flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white disabled:opacity-50"}),(0,a.jsx)("button",{type:"submit",disabled:h||!i.trim(),className:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:"执行"})]})})]})}class n{registerFunction(e,t){this.functionMap.set(e,t)}executeInstruction(e){let t=this.functionMap.get(e.action);if(!t)return console.warn('未找到操作 "'.concat(e.action,'" 对应的函数')),{success:!1,message:"不支持的操作: ".concat(e.action)};try{let s;switch(e.action){case"add":s=t(e.task);break;case"complete":case"delete":s=t(e.id||e.task);break;default:s=t()}if("object"==typeof s&&null!==s&&"success"in s)return s;return{success:!0,message:'操作 "'.concat(e.action,'" 执行成功'),data:s}}catch(t){return console.error("执行指令时发生错误:",t),{success:!1,message:'执行操作 "'.concat(e.action,'" 时发生错误')}}}getRegisteredActions(){return Array.from(this.functionMap.keys())}supportsAction(e){return this.functionMap.has(e)}constructor(){this.functionMap=new Map}}let o=new n;function d(e,t){return e.find(e=>e.text.toLowerCase().includes(t.toLowerCase())||t.toLowerCase().includes(e.text.toLowerCase()))}function i(){let[e,t]=(0,r.useState)([]),[s,c]=(0,r.useState)(""),{executeInstruction:n,getSupportedActions:i,addTodo:u,clearCompleted:g,clearAll:x}=function(e){let{todos:t,setTodos:s}=e,a=(0,r.useCallback)(e=>{let a="string"==typeof e?e:String(e||"");if(!a||""===a.trim())return{success:!1,message:"任务内容不能为空"};let r={id:Date.now(),text:a.trim(),completed:!1};return s([...t,r]),{success:!0,message:"已添加任务: ".concat(a),data:r}},[t,s]),c=(0,r.useCallback)(e=>{let a;return e?(a="number"==typeof e?t.find(t=>t.id===e):d(t,e))?a.completed?{success:!1,message:'任务 "'.concat(a.text,'" 已经完成了')}:(s(t.map(e=>e.id===a.id?{...e,completed:!0}:e)),{success:!0,message:"已完成任务: ".concat(a.text),data:{...a,completed:!0}}):{success:!1,message:"未找到任务: ".concat(e)}:{success:!1,message:"请指定要完成的任务"}},[t,s]),l=(0,r.useCallback)(e=>{let a;return e?(a="number"==typeof e?t.find(t=>t.id===e):d(t,e))?(s(t.filter(e=>e.id!==a.id)),{success:!0,message:"已删除任务: ".concat(a.text),data:a}):{success:!1,message:"未找到任务: ".concat(e)}:{success:!1,message:"请指定要删除的任务"}},[t,s]),n=(0,r.useCallback)(()=>{let e=t.filter(e=>e.completed).length,s=t.length-e;return{success:!0,message:"共有 ".concat(t.length," 个任务，其中 ").concat(e," 个已完成，").concat(s," 个待完成"),data:t}},[t]),i=(0,r.useCallback)(()=>{let e=t.filter(e=>e.completed);return 0===e.length?{success:!1,message:"没有已完成的任务需要清除"}:(s(t.filter(e=>!e.completed)),{success:!0,message:"已清除 ".concat(e.length," 个已完成的任务"),data:e})},[t,s]),u=(0,r.useCallback)(()=>{if(0===t.length)return{success:!1,message:"没有任务需要清除"};let e=t.length;return s([]),{success:!0,message:"已清除所有 ".concat(e," 个任务"),data:t}},[t,s]);return(0,r.useEffect)(()=>{o.registerFunction("add",a),o.registerFunction("complete",c),o.registerFunction("delete",l),o.registerFunction("list",n),o.registerFunction("clear_completed",i),o.registerFunction("clear_all",u)},[a,c,l,n,i,u]),{executeInstruction:(0,r.useCallback)(e=>{console.log("执行指令:",e);let t=o.executeInstruction(e);return console.log("执行结果:",t),t},[]),getSupportedActions:(0,r.useCallback)(()=>o.getRegisteredActions(),[]),addTodo:a,completeTodo:c,deleteTodo:l,listTodos:n,clearCompleted:i,clearAll:u}}({todos:e,setTodos:t}),m=()=>{if(""!==s.trim()){let e=u(s.trim());e.success?c(""):console.error("添加任务失败:",e.message)}},h=e=>{let t=n({action:"delete",id:e});t.success||console.error("删除任务失败:",t.message)},p=s=>{let a=e.find(e=>e.id===s);if(a&&!a.completed){let e=n({action:"complete",id:s});e.success||console.error("完成任务失败:",e.message)}else a&&a.completed&&t(e.map(e=>e.id===s?{...e,completed:!1}:e))},b=e.filter(e=>e.completed).length,f=e.length;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto h-[calc(100vh-2rem)] flex flex-col lg:flex-row gap-6",children:[(0,a.jsxs)("div",{className:"flex-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center text-gray-800 dark:text-white mb-2",children:"\uD83D\uDCDD 智能指令映射待办事项"}),(0,a.jsxs)("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:["AI 指令将映射到本地函数执行 | 支持操作: ",i().join(", ")]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,a.jsx)("input",{type:"text",value:s,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&m(),placeholder:"添加新任务...",className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),(0,a.jsx)("button",{onClick:m,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200 font-medium",children:"添加"})]}),f>0&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300 text-center",children:["总计: ",f," 任务 | 已完成: ",b," 任务 | 剩余: ",f-b," 任务"]})}),(0,a.jsx)("div",{className:"space-y-2",children:0===e.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"暂无任务，添加一个新任务开始吧！"}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-2",children:["\uD83D\uDCA1 你可以直接在此添加，或向",(0,a.jsx)("span",{className:"lg:inline hidden",children:"右侧"}),(0,a.jsx)("span",{className:"lg:hidden inline",children:"下方"}),"的 AI 助手发送指令"]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:"例如：“帮我添加一个学习任务” 或 “添加买菜任务”"})]}):e.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border transition-all duration-200 ".concat(e.completed?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-white dark:bg-gray-700 border-gray-200 dark:border-gray-600 hover:shadow-md"),children:[(0,a.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>p(e.id),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500 focus:ring-2"}),(0,a.jsx)("span",{className:"flex-1 ".concat(e.completed?"line-through text-gray-500 dark:text-gray-400":"text-gray-800 dark:text-white"),children:e.text}),(0,a.jsxs)("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:["ID: ",e.id]}),(0,a.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors duration-200",title:"删除任务",children:"\uD83D\uDDD1️"})]},e.id))}),e.length>0&&(0,a.jsxs)("div",{className:"mt-6 flex gap-2 justify-center",children:[(0,a.jsxs)("button",{onClick:()=>{let e=g();e.success||console.error("清除已完成任务失败:",e.message)},className:"px-4 py-2 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors duration-200",disabled:0===b,children:["清除已完成 (",b,")"]}),(0,a.jsx)("button",{onClick:()=>{let e=x();e.success||console.error("清除所有任务失败:",e.message)},className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200",children:"清除全部"})]})]}),(0,a.jsx)("div",{className:"w-full lg:w-80 h-96 lg:h-full",children:(0,a.jsx)(l,{executeInstruction:n})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[879,441,684,358],()=>t(668)),_N_E=e.O()}]);